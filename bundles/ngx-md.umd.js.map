{"version":3,"file":"ngx-md.umd.js.map","sources":["ng://ngx-md/lib/ngx-md.service.ts","ng://ngx-md/lib/ngx-md.component.ts","ng://ngx-md/lib/ngx-md.config.ts","ng://ngx-md/lib/ngx-md.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core'\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { throwError, Observable } from 'rxjs'\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { Renderer, setOptions, parse } from 'marked';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgxMdService {\r\n  private _renderer: any = new Renderer();\r\n  constructor(private _http: HttpClient) {\r\n    this.extendRenderer();\r\n    this.setMarkedOptions({});\r\n  }\r\n\r\n  // get the content from remote resource\r\n  getContent(path: string): Observable<any> {\r\n      return this._http.get(path, {responseType: 'text'}).pipe(map(res => res), catchError(this.handleError))\r\n  }\r\n\r\n   public get renderer() {\r\n     return this._renderer;\r\n   }\r\n\r\n   // handle data\r\n   public extractData(res: any): string {\r\n     return res.text() || '';\r\n   }\r\n\r\n   public setMarkedOptions(options: any) {\r\n     options = Object.assign({\r\n       gfm: true,\r\n       tables: true,\r\n       breaks: false,\r\n       pedantic: false,\r\n       sanitize: false,\r\n       smartLists: true,\r\n       smartypants: false\r\n     }, options);\r\n     options.renderer = this._renderer;\r\n     setOptions(options);\r\n   }\r\n\r\n   // comple markdown to html\r\n   public compile(data: string) {\r\n      return parse(data);\r\n   }\r\n\r\n   // handle error\r\n   private handleError(error: any): any {\r\n     let errMsg: string;\r\n     if (error instanceof fetch) {\r\n       const body = error.json() || '';\r\n       const err = body.error || JSON.stringify(body);\r\n       errMsg = `${error.status} - ${error.statusText || ''} ${err}`;\r\n     } else {\r\n       errMsg = error.message ? error.message : error.toString();\r\n     }\r\n     return throwError(errMsg);\r\n   }\r\n\r\n   // extend marked render to support todo checkbox\r\n   private extendRenderer() {\r\n     this._renderer.listitem = function(text: string) {\r\n      if (/^\\s*\\[[x ]\\]\\s*/.test(text)) {\r\n      text = text\r\n        .replace(/^\\s*\\[ \\]\\s*/, '<input type=\"checkbox\" style=\" vertical-align: middle; margin: 0 0.2em 0.25em -1.6em; font-size: 16px; \" disabled> ')\r\n        .replace(/^\\s*\\[x\\]\\s*/, '<input type=\"checkbox\" style=\" vertical-align: middle; margin: 0 0.2em 0.25em -1.6em; font-size: 16px; \" checked disabled> ');\r\n          return '<li style=\"list-style: none\">' + text + '</li>';\r\n        } else {\r\n          return '<li>' + text + '</li>';\r\n        }\r\n      };\r\n   }\r\n}\r\n","\r\nimport { Component, ElementRef, OnInit, AfterViewInit, Input, PLATFORM_ID, Inject } from '@angular/core';\r\nimport { NgxMdService } from './ngx-md.service';\r\nimport { isPlatformBrowser } from '@angular/common';\r\nimport * as Prism from 'prismjs';\r\n\r\n@Component({\r\n    selector: 'markdown,[Markdown],ngx-md,[NgxMd]',\r\n    template: '<ng-content></ng-content>',\r\n    styles: [\r\n        `.token.operator, .token.entity, .token.url, .language-css .token.string, .style .token.string {\r\n            background: none;\r\n        }`\r\n    ]\r\n})\r\nexport class NgxMdComponent implements  AfterViewInit {\r\n    private _path: string;\r\n    private _data: string;\r\n    private _md: any;\r\n    private _ext: string;\r\n    changeLog: string[] = [];\r\n\r\n    constructor(\r\n        private _mdService: NgxMdService,\r\n        private _el: ElementRef,\r\n        @Inject(PLATFORM_ID) private platformId: string\r\n    ) { }\r\n\r\n   \r\n\r\n    @Input()\r\n    set path(value: string) {\r\n      if (value) {\r\n        this._path = value;\r\n        this.onPathChange();\r\n      }\r\n    }\r\n\r\n    @Input()\r\n    set data(value: string) {\r\n      if (value) {\r\n        this._data = value;\r\n        this.onDataChange(value);\r\n      }\r\n    }\r\n\r\n\r\n    // on input\r\n    onDataChange(data: string) {\r\n      if (data) {\r\n        this._el.nativeElement.innerHTML = this._mdService.compile(data);\r\n      } else {\r\n        this._el.nativeElement.innerHTML = '';\r\n      }\r\n      this.highlightContent(false);\r\n    }\r\n\r\n    /**\r\n     *  After view init\r\n     */\r\n    ngAfterViewInit() {\r\n      if (this._path) {\r\n        this.onPathChange();\r\n      } else if (!this._data) {\r\n        this.processRaw();\r\n      }\r\n    }\r\n\r\n    processRaw() {\r\n      this._md = this.prepare(decodeHtml(this._el.nativeElement.innerHTML));\r\n      this._el.nativeElement.innerHTML = this._mdService.compile(this._md);\r\n      this.highlightContent(false);\r\n    }\r\n\r\n    /**\r\n     * get remote conent;\r\n     */\r\n    onPathChange() {\r\n        this._ext = this._path && this._path.split('.').splice(-1).join();\r\n        this._mdService.getContent(this._path)\r\n            .subscribe(data => {\r\n                this._md = this._ext !== 'md' ? '```' + this._ext + '\\n' + data + '\\n```' : data;\r\n                this._el.nativeElement.innerHTML = this._mdService.compile(this.prepare(this._md));\r\n                this.highlightContent(false);\r\n            },\r\n            err => this.handleError);\r\n    }\r\n\r\n    /**\r\n     * catch http error\r\n     */\r\n    private handleError(error: any): Promise<any> {\r\n        console.error('An error occurred', error); // for demo purposes only\r\n        return Promise.reject(error.message || error);\r\n    }\r\n\r\n    /**\r\n     * Prepare string\r\n     */\r\n     prepare(raw: string) {\r\n        if (!raw) {\r\n            return '';\r\n        }\r\n        if (this._ext === 'md' || !this.path) {\r\n            let isCodeBlock = false;\r\n            return raw.split('\\n').map((line: string) => {\r\n                if (this.trimLeft(line).substring(0, 3) === '```') {\r\n                    isCodeBlock = !isCodeBlock;\r\n                }\r\n                return isCodeBlock ? line : line.trim();\r\n            }).join('\\n');\r\n        }\r\n        return raw.replace(/\\\"/g, '\\'');\r\n    }\r\n\r\n    /**\r\n     * Trim left whitespace\r\n     */\r\n    private trimLeft(line: string) {\r\n        return line.replace(/^\\s+|\\s+$/g, '');\r\n    }\r\n\r\n    /**\r\n     * Use Prism to highlight code snippets only on the browser\r\n     */\r\n    private highlightContent(async: boolean): void {\r\n      if (isPlatformBrowser(this.platformId)) {\r\n        Prism.highlightAll(async);\r\n      }\r\n    }\r\n}\r\n\r\nfunction decodeHtml(html: string) { // https://stackoverflow.com/a/7394787/588521\r\n    const txt = document.createElement('textarea');\r\n    txt.innerHTML = html;\r\n    return txt.value;\r\n}\r\n\r\n","import { Injectable } from '@angular/core';\r\n\r\n@Injectable()\r\nexport class NgxMdConfig {\r\n  /** config modue */\r\n\r\n}\r\n","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { NgxMdService } from './ngx-md.service';\r\nimport { NgxMdConfig } from './ngx-md.config';\r\nimport { NgxMdComponent } from './ngx-md.component';\r\n\r\n@NgModule({\r\n  declarations: [NgxMdComponent],\r\n  providers: [NgxMdService],\r\n  exports: [NgxMdComponent],\r\n})\r\nexport class NgxMdModule {\r\n  public static forRoot(): ModuleWithProviders {\r\n    return {\r\n      ngModule: NgxMdModule,\r\n      providers: [NgxMdConfig]\r\n    };\r\n  }\r\n}\r\n"],"names":["Renderer","map","catchError","setOptions","parse","throwError","Injectable","HttpClient","isPlatformBrowser","Prism.highlightAll","Component","ElementRef","Inject","PLATFORM_ID","Input","NgModule"],"mappings":"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"}
